# sequence-alignments-based-on-the-structure

We developed an integrated computational workflow that leverages structural alignment information to generate a multiple sequence alignment (MSA) of protein sequences. The entire workflow consists of three main steps: (i) performing structural alignment using the Combinatorial Extension (CE) algorithm implemented by the built-in cealign command in PyMOL; (ii) extracting residue correspondences and generating pairwise sequence alignments based on spatial proximity; and (iii) integrating these local alignments to construct a global MSA in FASTA format. In the first step, the CE algorithm, originally proposed by Shindyalov and Bourne (1998), is employed within the PyMOL environment via the cealign command. The CE algorithm works by decomposing protein structures into short, overlapping fragments known as Aligned Fragment Pairs (AFPs). It then searches for AFPs that exceed a predefined threshold of geometric similarity. Once identified, the algorithm applies a combinatorial extension strategy to optimally assemble these AFPs, maximizing the total number of aligned residues while minimizing the root-mean-square deviation (RMSD) between corresponding Cα atoms. In our workflow, the RSAD2 protein from pig is selected as the reference structure (ref.pdb). All target structures within the specified directory are loaded into PyMOL, and for each target, the cealign command is used to compute the optimal superposition with the reference. For each target structure, spatial filters based on the proximity of Cα atoms are applied to identify aligned residues; residues whose Cα atoms lie within a defined threshold distance (2.0 Å) are considered aligned. These aligned residues are then used to extract the corresponding fragments from the full-length sequences. The resulting pairwise sequence alignments reflect the structural overlaps identified by the CE algorithm. Finally, all pairwise alignments are merged to construct the global MSA. Each local alignment is first examined to ensure that the reference sequence fragment remains consistent across different target alignments. If minor variations are detected, the most representative fragment is chosen as the consensus. All target sequences are then aligned against this consensus reference fragment to generate the final integrated MSA.

This project implements a workflow for batch protein structure alignment and, based on the structure alignments, extracts the corresponding protein sequence alignments. Finally, it combines the individual alignments into a multiple sequence alignment (MSA) file.
The overall workflow consists of three main steps:
Structure Alignment (ce_align.py)
Extraction of Sequence Alignments Based on Structure Alignments (seq_alignment.py)
Merging Sequence Alignments to Generate an MSA (msa_generator.py)
Each step produces both log files and necessary output files (such as the PyMOL session and FASTA files) for downstream analysis.

Directory Structure:
Project files and folders are organized as follows:
ce_align.py : Script 1 – Performs batch structure alignment using PyMOL’s CE algorithm.
seq_alignment.py : Script 2 – Extracts protein sequence alignments from the structure alignment results.
msa_generator.py : Script 3 – Merges the individual sequence alignment files into a complete MSA file.
pdbs/ : Folder that contains all PDB files. It must include the reference structure file (ref.pdb).

alignment.log : Log file generated by ce_align.py containing alignment details and RMSD values.
seq_alignment.log : Log file generated by seq_alignment.py.
msa_generator.log : Log file generated by msa_generator.py.
alignment.pse : PyMOL session file saved from the structure alignment step.
aligned.msa.fasta : Final multiple sequence alignment (MSA) file in FASTA format.

Environment and Dependencies:
You will need:
Python 3.x
PyMOL (with a version supporting the pymol2 module) For example, using conda: conda install -c schrodinger pymol
BioPython (optional, if advanced sequence processing is required) Install with: pip install biopython
Standard Python libraries: os, glob, logging, datetime, etc.

Usage Instructions:
Prepare PDB Files: Place all PDB files to be aligned into the "pdbs" folder. Ensure that the reference structure is named "ref.pdb".
Run Structure Alignment: Execute the ce_align.py script to perform structure alignments using PyMOL’s CE algorithm. Command: python ce_align.py This step will process the PDB files in the "pdbs" folder, align them relative to ref.pdb, generate the alignment.log log file, and save the PyMOL session as alignment.pse.
Extract Protein Sequence Alignment: Run the seq_alignment.py script, which loads the PyMOL session (alignment.pse) and, using a CA-atom distance-based method, extracts aligned residue regions. For each target structure, a FASTA file (named {target}_seq_align.fasta) will be generated. Command: python seq_alignment.py
Merge Alignments to Generate MSA: Execute the msa_generator.py script to merge all individual sequence alignment FASTA files into a single multiple sequence alignment file (aligned.msa.fasta). Command: python msa_generator.py

Output Results:
After running the scripts, you will obtain:
alignment.log: Detailed log of the structure alignment process and RMSD metrics.
alignment.pse: PyMOL session file that includes all aligned structures for visualization and verification.
seq_alignment.log: Log file for the sequence extraction process.
Individual FASTA files (e.g., target1_seq_align.fasta) for each target structure’s sequence alignment.
msa_generator.log: Log file from the MSA merging process.
aligned.msa.fasta: The final multiple sequence alignment file (in FASTA format) for downstream analysis, such as functional prediction, evolutionary studies, or structural modeling.

Notes:
PyMOL Environment: Ensure that PyMOL starts correctly and that the pymol2 module is functioning with your installed version.
Structure Alignment Mapping: The sequence alignment in step two is based on a heuristic method using CA-atom distances (default threshold of 2.0 Å). This method approximates corresponding residues after alignment; if major insertions or deletions occur, consider adjusting the distance threshold or using alternative mapping methods.
Logging: Detailed logs are provided at each step (alignment.log, seq_alignment.log, msa_generator.log) to help with debugging and verifying the process.

License:
This project is open source under the MIT License. Refer to the LICENSE file for full details.
